    <script type="text/javascript">
      /* Import methods into global namespace */
      var test = jsx.debug.test;
      var isMethod = jsx.object.isMethod;
      var isNativeMethod = jsx.object.isNativeMethod;
      var getFeature = jsx.object.getFeature;
    </script>
<?php
  if (!$this->edit)
  {
?>
     <a href="<?php echo $this->escape($this->getURL(null, 'edit')); ?>">Edit</a>
<?php
  }
  else
  {
?>
     <a href="<?php echo $this->escape($this->getURL(null, 'endEdit')); ?>">End Edit</a>
<?php
  }
?>
    <form action="<?php echo $this->escape($this->getURL(null, 'saveResult')); ?>" method="POST">
      <table id="features-table"
             summary="Language features and the first editions of ECMAScript or first versions of the implementations that introduced or supported them">
        <thead>
          <tr>
<?php
  if ($this->edit)
  {
?>
            <td style="width: 7em">&nbsp;</td>
<?php
  }
?>
            <th id="atoz">
<?php
  if ($this->edit)
  {
?>
              <a href="<?php echo $this->escape($this->getURL('feature', 'add')); ?>"
                 title="Add feature"
                 class="add">Add</a>
<?php
  }
?>
              Feature
            </th>
            <th><a href="#ecmascript">ECMAScript</a></th>
            <th>This <abbr title="implementation">impl.</abbr><?php
                // $footnotes->add('this-impl', '', $scriptEngineTest, '');
                ?><br>
              <script type="text/javascript">
                var implementation = isMethod(this, "ScriptEngine") ? ScriptEngine() : '';
                if (implementation)
                {
                  implementation = implementation.replace(/"/g, "&quot;").replace(/</g, "&gt;");
                  var version = '';
                  if (isMethod(this, "ScriptEngineMajorVersion"))
                  {
                    version = ScriptEngineMajorVersion();

                    if (isMethod(this, "ScriptEngineMinorVersion"))
                    {
                      version += "." + ScriptEngineMinorVersion();

                      if (isMethod(this, "ScriptEngineBuildVersion"))
                      {
                        version += "." + ScriptEngineBuildVersion();
                      }
                    }

                    if (version)
                    {
                      version = version.replace(/"/g, "&quot;").replace(/</g, "&gt;");
                    }
                  }
                      
                  document.write(
                    '<input type="hidden" name="implementation" value="' + implementation + '">'
                    + '<input type="hidden" name="version" value="' + version + '">');
                }
              </script>
              <input type="submit" name="submitResults" value="Submit results"></th>
<?php
  foreach ($this->implementations as $key => $impl)
  {
    if ($key !== 0)
    {
?>
            <td><?php
              if ($impl->acronym !== '')
              {
                ?><abbr title="<?php echo $this->escape($impl->name); ?>"><?php
                echo $this->escape($impl->acronym);
              }
              else
            {
                echo $this->escape($impl->name);
              }
        
              if ($impl->acronym !== '')
              {
                ?></abbr><?php
              }
              
              if ($this->edit)
              {
                ?><br>
                <a href="<?php echo $this->escape($this->getURL('implementation', 'edit', $impl->id)); ?>"
                   class="edit">Edit</a><?php
              }
            ?></td>
<?php
    }
  }
  
  if ($this->edit)
  {
?>
            <td><a href="<?php echo $this->escape($this->getURL('implementation', 'add')); ?>"
                   title="Add implementation"
                   class="add">Add</a></td>
<?php
  }
?>
          </tr>
        </thead>
        <tbody id="scroller" class="scroll">
<?php
  foreach ($this->features as $key => $feature)
  {
?>
          <tr>
<?php
    if ($this->edit)
    {
?>
            <td><a href="<?php echo $this->escape($this->getURL('feature', 'edit', $feature->id)); ?>"
                   class="edit">Edit</a>
                <form action="<?php echo $this->escape($this->getURL('feature', 'delete')); ?>" method="POST"
                      onsubmit="return window.confirm('Delete feature &quot;<?php echo addslashes($this->escape(strip_tags($feature->code))); ?>&quot;?')"
                      style="display: inline">
                  <input type="hidden" name="id" value="<?php echo $feature->id; ?>">
                  <button type="submit" class="negative delete">Delete</button>
                </form></td>
<?php
    }
?>
            <th id="feature<?php echo $feature->id; ?>"<?php
                if ($feature->title)
                {
                  ?> title="<?php echo $this->escape($feature->title); ?>"<?php
                }
                ?>><?php echo $feature->code; ?></th>
            <td><?php
              if ($feature->edition)
              {
                echo $feature->edition;
                if ($feature->section)
                {
                  ?> <span class="section" title="Specification section">[<?php
                    echo $feature->section;
                  ?>]</span><?php
                }
              }
            ?></td>
            <td<?php
              $id = 'td' . ($key + 1);
              $testcases = $feature->testcases;
              if (count($testcases) > 0)
              {
                echo " id='$id'";
                echo ' title="Test code: '
                  . $this->escape(implode("\n", array_map(create_function('$e', 'return $e->code;'), $testcases)))
                  . '"';
              }
              else
            {
                echo ' title="Not applicable: No automated test case'
                  . ' is available for this feature.  If possible, please'
                  . ' click the feature code in the first column to run'
                  . ' a manual test."';
              }
              ?>><?php
              if (count($testcases) > 0)
              {
                ?><script type="text/javascript">
                    var results = [];
                  </script><?php
                foreach ($testcases as $testcase_key => $testcase)
                {
                  ?><script type="text/javascript">
                    var result = false;
                  </script>
                  <script type="<?php
                    if ($testcase->alt_type)
                    {
                      echo $this->escape($testcase->alt_type);
                    }
                    else
                    {
                      echo 'text/javascript';
                    }
                    ?>">
                    <?php
                      $code = $testcase->code;
                      if ($testcase->quoted)
                      {
                        $code = '"' . preg_replace('/(\\r?\\n|\\r)/', '\\n', addslashes($code)) . '"';
                      }
                    ?>
                    result = test(<?php echo str_replace('</', '<\\/', $code); ?>, true, false);
                  </script>
                  <script type="text/javascript">
                    results[<?php echo $testcase_key; ?>] = result;
                    document.write('<input type="hidden" name="results[<?php echo $testcase->id; ?>]" value="' + (result ? '1' : '0') + '">');
                  </script><?php
                }
                ?><script type="text/javascript">
                  var count = 0;
                  for (var i = 0, len = results.length; i < len; ++i)
                  {
                    if (results[i])
                    {
                      ++count;
                    }
                  }
  
                  var text = (count == len) ? "+" : (count == 0 ? "&#8722;" : "*");
                  
                  jsx.tryThis(
                    "document.write(text);",
                    " document.getElementById('<?php echo $id; ?>').appendChild("
                    + "document.createTextNode(text));");
                </script><?php
              }
              else
            {
                echo '<abbr>N/A</abbr>';
              }
              ?></td>
            </tr>
<?php
  }
?>
          </tbody>
      </table>
    </form>
